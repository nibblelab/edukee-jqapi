/* 
 * edukee-jqapi - Nibblelab Tecnologia LTDA - MIT license
 * https://github.com/nibblelab/edukee-jqapi
 */
var EdukeeAPI={endPoint:"https://www.edukee.com.br/api",token:"",results:{error:{},cursos:[],curso:{},curso_img:{},turmas:[],turma:{},turma_img:{},turma_contrato:{},campos_inscricao:[]},testToken:function(e,r){var u=EdukeeAPI.endPoint+"/integracao/test?token="+EdukeeAPI.token;jQuery.ajax({type:"GET",beforeSend:function(e){e.setRequestHeader("Authorization","token="+EdukeeAPI.token)},url:u,success:function(u){"ok"==u.status?(jQuery(document).trigger("edukee:token_test_success"),void 0!=e&&e()):(EdukeeAPI.results.error=u,jQuery(document).trigger("edukee:token_test_error"),void 0!=r&&r(u))},error:function(e){EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:token_test_error"),void 0!=r&&r(e)}})},getCursos:function(e,r,u,t,s,o){var d=void 0==e?"":e,a=void 0==r?"":r,i=void 0==u?"":u,n=void 0==t?"":t,c=EdukeeAPI.endPoint+"/cursos/all?page="+d+"&pageSize="+a+"&searchBy="+i+"&orderBy="+n+"&stat=A";jQuery.ajax({type:"GET",beforeSend:function(e){e.setRequestHeader("Authorization","token="+EdukeeAPI.token)},url:c,success:function(e){"ok"==e.status?(EdukeeAPI.results.cursos=e,jQuery(document).trigger("edukee:get_cursos_success"),void 0!=s&&s(e)):(EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:get_cursos_error"),void 0!=o&&o(e))},error:function(e){EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:get_cursos_error"),void 0!=o&&o(e)}})},getCursoImg:function(e,r,u){var t="",s="",o="";for(var d in EdukeeAPI.results.cursos.datas)if(EdukeeAPI.results.cursos.datas[d].id==e){t=EdukeeAPI.results.cursos.datas[d].nome,s=EdukeeAPI.results.cursos.datas[d].token,o=EdukeeAPI.results.cursos.datas[d].imagem;break}if(""!=t&&""!=s&&""!=o||EdukeeAPI.results.curso.id==e&&(t=EdukeeAPI.results.curso.nome,s=EdukeeAPI.results.curso.token,o=EdukeeAPI.results.curso.imagem),""==t||""==s||""==o){var a={status:"no",msg:"Não consegui achar o curso na listagem"};return EdukeeAPI.results.error=a,jQuery(document).trigger("edukee:get_curso_img_error"),void(void 0!=u&&u(a))}var i=EdukeeAPI.endPoint+"/download.php?isAPI=true&tipo=curso_logo&nome="+t+"&id="+e+"&curso="+s+"&file="+o;jQuery.ajax({type:"GET",beforeSend:function(e){e.setRequestHeader("Authorization","token="+EdukeeAPI.token)},url:i,success:function(e){"ok"==e.status?(EdukeeAPI.results.curso_img=e,jQuery(document).trigger("edukee:get_curso_img_success"),void 0!=r&&r(e)):(EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:get_curso_img_error"),void 0!=u&&u(e))},error:function(e){EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:get_curso_img_error"),void 0!=u&&u(e)}})},getCurso:function(e,r,u){for(var t in EdukeeAPI.results.cursos.datas)if(EdukeeAPI.results.cursos.datas[t].id==e)return EdukeeAPI.results.curso=EdukeeAPI.results.cursos.datas[t],jQuery(document).trigger("edukee:get_curso_success"),void(void 0!=r&&r(EdukeeAPI.results.cursos.datas[t]));var s=EdukeeAPI.endPoint+"/cursos/me?id="+e;jQuery.ajax({type:"GET",beforeSend:function(e){e.setRequestHeader("Authorization","token="+EdukeeAPI.token)},url:s,success:function(e){"ok"==e.status?(EdukeeAPI.results.curso=e.datas,jQuery(document).trigger("edukee:get_curso_success"),void 0!=r&&r(e.datas)):(EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:get_curso_error"),void 0!=u&&u(e))},error:function(e){EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:get_curso_error"),void 0!=u&&u(e)}})},getTurmas:function(e,r,u,t,s,o,d){var a=void 0==r?"":r,i=void 0==u?"":u,n=void 0==t?"":t,c=void 0==s?"":s,k=EdukeeAPI.endPoint+"/turmas/all?page="+a+"&pageSize="+i+"&searchBy="+n+"&orderBy="+c+"&curso="+e+"&inscricaoAtiva=A";jQuery.ajax({type:"GET",beforeSend:function(e){e.setRequestHeader("Authorization","token="+EdukeeAPI.token)},url:k,success:function(e){"ok"==e.status?(EdukeeAPI.results.turmas=e,jQuery(document).trigger("edukee:get_turmas_success"),void 0!=o&&o(e)):(EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:get_turmas_error"),void 0!=d&&d(e))},error:function(e){EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:get_turmas_error"),void 0!=d&&d(e)}})},getTurmaImg:function(e,r,u){var t="",s="",o="",d="";for(var a in EdukeeAPI.results.turmas.datas)if(EdukeeAPI.results.turmas.datas[a].id==e){t=EdukeeAPI.results.turmas.datas[a].nome,s=EdukeeAPI.results.turmas.datas[a].curso_token,o=EdukeeAPI.results.turmas.datas[a].token,d=EdukeeAPI.results.turmas.datas[a].flyer;break}if(""!=t&&""!=s&&""!=o&&""!=d||EdukeeAPI.results.turma.id==e&&(t=EdukeeAPI.results.turma.nome,s=EdukeeAPI.results.turma.curso_token,o=EdukeeAPI.results.turma.token,d=EdukeeAPI.results.turma.flyer),""==t||""==s||""==o||""==d){var i={status:"no",msg:"Não consegui achar a turma na listagem"};return EdukeeAPI.results.error=i,jQuery(document).trigger("edukee:get_turma_img_error"),void(void 0!=u&&u(i))}var n=EdukeeAPI.endPoint+"/download.php?isAPI=true&tipo=turma_logo&nome="+t+"&id="+e+"&turma="+o+"&curso="+s+"&file="+d;jQuery.ajax({type:"GET",beforeSend:function(e){e.setRequestHeader("Authorization","token="+EdukeeAPI.token)},url:n,success:function(e){"ok"==e.status?(EdukeeAPI.results.turma_img=e,jQuery(document).trigger("edukee:get_turma_img_success"),void 0!=r&&r(e)):(EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:get_turma_img_error"),void 0!=u&&u(e))},error:function(e){EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:get_turma_img_error"),void 0!=u&&u(e)}})},getTurma:function(e,r,u){for(var t in EdukeeAPI.results.turmas.datas)if(EdukeeAPI.results.turmas.datas[t].id==e)return EdukeeAPI.results.turma=EdukeeAPI.results.turmas.datas[t],jQuery(document).trigger("edukee:get_turma_success"),void(void 0!=r&&r(EdukeeAPI.results.turmas.datas[t]));var s=EdukeeAPI.endPoint+"/turmas/me?id="+e;jQuery.ajax({type:"GET",beforeSend:function(e){e.setRequestHeader("Authorization","token="+EdukeeAPI.token)},url:s,success:function(e){"ok"==e.status?(EdukeeAPI.results.turma=e.datas,jQuery(document).trigger("edukee:get_turma_success"),void 0!=r&&r(e.datas)):(EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:get_turma_error"),void 0!=u&&u(e))},error:function(e){EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:get_turma_error"),void 0!=u&&u(e)}})},getTurmaContrato:function(e,r,u){var t="",s="",o="",d="";for(var a in EdukeeAPI.results.turmas.datas)if(EdukeeAPI.results.turmas.datas[a].id==e){t=EdukeeAPI.results.turmas.datas[a].nome,s=EdukeeAPI.results.turmas.datas[a].curso_token,o=EdukeeAPI.results.turmas.datas[a].token,d=EdukeeAPI.results.turmas.datas[a].contrato;break}if(""!=t&&""!=s&&""!=o&&""!=d||EdukeeAPI.results.turma.id==e&&(t=EdukeeAPI.results.turma.nome,s=EdukeeAPI.results.turma.curso_token,o=EdukeeAPI.results.turma.token,d=EdukeeAPI.results.turma.contrato),""==t||""==s||""==o||""==d){var i={status:"no",msg:"Não consegui achar a turma na listagem"};return EdukeeAPI.results.error=i,jQuery(document).trigger("edukee:get_turma_contrato_error"),void(void 0!=u&&u(i))}var n=EdukeeAPI.endPoint+"/download.php?isAPI=true&tipo=turma_contrato&nome="+t+"&id="+e+"&turma="+o+"&curso="+s+"&file="+d;jQuery.ajax({type:"GET",beforeSend:function(e){e.setRequestHeader("Authorization","token="+EdukeeAPI.token)},url:n,success:function(e){"ok"==e.status?(EdukeeAPI.results.turma_contrato=e,jQuery(document).trigger("edukee:get_turma_contrato_success"),void 0!=r&&r(e)):(EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:get_turma_contrato_error"),void 0!=u&&u(e))},error:function(e){EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:get_turma_contrato_error"),void 0!=u&&u(e)}})},getInscricaoForm:function(e,r,u){for(var t in EdukeeAPI.results.cursos.datas)EdukeeAPI.results.cursos.datas[t].id==e&&(EdukeeAPI.results.campos_inscricao=jQuery.parseJSON(EdukeeAPI.results.cursos.datas[t].campos_inscricao));if(0==EdukeeAPI.results.campos_inscricao.length&&(jQuery.isEmptyObject(EdukeeAPI.results.curso)||(EdukeeAPI.results.campos_inscricao=jQuery.parseJSON(EdukeeAPI.results.curso.campos_inscricao))),EdukeeAPI.results.campos_inscricao.length>0)return jQuery(document).trigger("edukee:get_inscricao_form_success"),void(void 0!=r&&r(EdukeeAPI.results.campos_inscricao));var s=EdukeeAPI.endPoint+"/cursos/me?id="+e;jQuery.ajax({type:"GET",beforeSend:function(e){e.setRequestHeader("Authorization","token="+EdukeeAPI.token)},url:s,success:function(e){"ok"==e.status?(EdukeeAPI.results.campos_inscricao=jQuery.parseJSON(e.datas.campos_inscricao),jQuery(document).trigger("edukee:get_inscricao_form_success"),void 0!=r&&r(EdukeeAPI.results.campos_inscricao)):(EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:get_inscricao_form_error"),void 0!=u&&u(e))},error:function(e){EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:get_inscricao_form_error"),void 0!=u&&u(e)}})},doInscricao:function(e,r,u,t,s){EdukeeAPI.getInscricaoForm(e,function(o){var d={};for(var a in o)d[o[a].field]="";d.curso=e,d.turma=r,d.modulos="",d.disciplinas="",d.aulas="";for(var a in u)d.hasOwnProperty(u[a].field)&&(d[u[a].field]=u[a].value);var i=EdukeeAPI.endPoint+"/inscricao/inscrevame";jQuery.ajax({type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","token="+EdukeeAPI.token)},url:i,data:JSON.stringify(d),contentType:"application/json; charset=utf-8",success:function(e){"ok"==e.status?(jQuery(document).trigger("edukee:do_inscricao_success"),void 0!=t&&t()):(EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:do_inscricao_error"),void 0!=s&&s(e))},error:function(e){EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:do_inscricao_error"),void 0!=s&&s(e)}})},function(e){EdukeeAPI.results.error=e,jQuery(document).trigger("edukee:do_inscricao_error"),void 0!=s&&s(e)})},init:function(e){EdukeeAPI.token=e,console.log("*** Edukee API loaded *** ")}};

